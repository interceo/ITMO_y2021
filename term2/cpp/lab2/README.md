# Лабораторная работа 2 \
Декодирование PNG

В целом нужно сделать ровно один фикс - руки есть, загуглите


## **Цель работы**

Изучить особенности работы с двоичными файлами, структурами, директивами препроцессора и сторонними библиотеками в C. Закрепить навык чтения спецификаций.


## **Стандарт языка**

С11 и новее.


## **Описание**

Необходимо реализовать программу, которая декодирует изображение PNG в PNM. 

**_должны поддерживаться: _**серые и цветные изображения (Color Type 0 и 2), 8 бит на канал.

**_не нужно поддерживать:_** работу с прозрачностью, interlacing и цветовую коррекцию (гамму и пр.).

Необходимо использовать одну библиотеку из следующих: libdeflate, zlib или isa-l (на ваше усмотрение).

**Критерий “Все библиотеки”: **должно поддерживаться использование всех трёх сторонних библиотек: zlib, libdeflate и isa-l.

Библиотеки должны использоваться только для разжатия deflate-потока из изображения.


## **Использование сторонних библиотек**

Кроме zlib, libdeflate и isa-l запрещено использовать какие-либо другие сторонние библиотеки (стандартную библиотеку С использовать можно и нужно).


<table>
  <tr>
   <td><strong>Библиотека</strong>
   </td>
   <td><strong>Версия</strong>
   </td>
   <td><strong>Подключение</strong>
   </td>
  </tr>
  <tr>
   <td>zlib
   </td>
   <td>1.2.12
   </td>
   <td><code>#include &lt;zlib.h></code>
   </td>
  </tr>
  <tr>
   <td>libdeflate
   </td>
   <td>1.10
   </td>
   <td><code>#include &lt;libdeflate.h></code>
   </td>
  </tr>
  <tr>
   <td>isa-l
   </td>
   <td>2.30
   </td>
   <td><code>#include &lt;include/igzip_lib.h></code>
   </td>
  </tr>
</table>


Для вашего репозитория (на github) исходный файл, содержащий функцию main, должен лежать в корне репозитория. Пример: 


```
/c_2-<github_nickname>
├── main.c /* your src file*/
├── my_header.h /* [optional] your header file */
├── .gitignore /* [optional] */
├── .clang-format
├── …

```


**Внимание!** В репозитории не должно быть любых файлов zlib, libdeflate и isa-l. Вы можете их хранить рядом локально, но в этом случае они должны быть занесены .gitignore.

Выбор библиотеки должен определяться макросом, который указывается ключом компилятора, создающим define. Гарантируется, что при компиляции будет указан ровно один из трёх макросов.


<table>
  <tr>
   <td><strong>Библиотека</strong>
   </td>
   <td>zlib
   </td>
   <td>libdeflate
   </td>
   <td>isa-l
   </td>
  </tr>
  <tr>
   <td><strong>define</strong>
   </td>
   <td><code>ZLIB</code>
   </td>
   <td><code>LIBDEFLATE</code>
   </td>
   <td><code>ISAL</code>
   </td>
  </tr>
</table>


В случае, если при компиляции был указан макрос, определяющий подключение библиотеки, которую ваша программа не поддерживает, то необходимо командой препроцессора #error() выводить сообщение о том, что данная библиотека не поддерживается. Подробнее: [https://en.cppreference.com/w/c/preprocessor/error](https://en.cppreference.com/w/c/preprocessor/error) 

Примеры:


<table>
  <tr>
   <td><code>#if defined(ZLIB)</code>
<p>
<code>#error …</code>
   </td>
   <td><code>#ifdef ZLIB</code>
<p>
<code>#error …</code>
   </td>
  </tr>
</table>



## **Формат аргументов командной строки**

Аргументы программе передаются через командную строку:


```
c2 <имя_входного_PNG_файла> <имя_выходного_PNM_файла>
```



## **Входной файл**

PNG-изображение. Не гарантируется корректность данных внутри файла (может быть любой файл, в том числе не PNG или файл с ошибками).


## **Выходной файл**

Формат выходных изображений: PNM (P5 или P6). Во всех PNM файлах (pgm, ppm) комментарии отсутствуют. 

Если изображения во входном файле было в оттенках серого (Color Type 0), то выходное изображение должно быть в формате P5. Если входное было Color Type 2, то на выходе - P6.

Формат представлен ниже:


<table>
  <tr>
   <td>P5 (PGM)
   </td>
   <td><code>"P5\n&lt;width> &lt;height>\n255\n&lt;Gray_data>"</code>
   </td>
  </tr>
  <tr>
   <td>P6 (PPM)
   </td>
   <td><code>"P6\n&lt;width> &lt;height>\n255\n&lt;RGB_data>"</code>
   </td>
  </tr>
</table>


Windows: 



* можно установить [WIC Codec](https://drive.google.com/drive/folders/1UnOW5W2UATMk4R9F2rqMX5j4ZwcfbIN3?usp=sharing) для просмотра PNM через стандартный просмотрщик изображений
* Gimp и Photoshop поддерживают PNM “из коробки”

Linux / Mac OS:  поддерживают PNM “из коробки”


## **Требования к программе**



1. должна быть написана на C по заданному стандарту;
2. должна выполнять поставленную в ТЗ задачу;
3. не использовать внешние библиотеки, кроме указанных выше;
4. всегда корректно освобождать память и закрывать файлы;
5. обрабатывать ошибки: 
    1. файл не открылся; 
    2. не удалось выделить память;
    3. на вход передано неверное число аргументов командной строки;
    4. аргументы некорректны;
    5. формат файла не поддерживается;
    6. входной файл некорректен.

    В этих случаях необходимо выдавать сообщение об ошибке и корректно завершаться с ненулевым кодом возврата (см. `"return_codes.h"`);

6. не писать в консоль ничего лишнего, кроме сообщений об ошибках и по желанию краткой справки по использованию (при запуске с неправильным числом аргументов).

**Сообщение об ошибке необходимо выводить в поток вывода ошибок**. Если вы будете выводить сообщение об ошибке в стандартный поток вывода, то это будет засчитываться за проваленный тест.


## **Ограничения**



1. Запрещено  использование exit(...) в коде.
2. Запрещено  создавать VLA-массивы (но можно VLA-указатели).
3. Ограничивается использование глобальных переменных (кроме констант) - необходимость их использования вы должны обосновать на защите. Ваш код должен быть максимально приспособлен к переносимости в другие проекты и/или использованию другими разработчиками.
4. Запрещается подключать системные библиотеки через `#include "..."`.
5. Запрещается использовать setlocale(...). Учимся писать небольшие комментарии пользователю по-английски.
6. Запрещается использовать system(“pause”).